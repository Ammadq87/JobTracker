mixin formInput(val, type, req, defaultValue)
    - const displayVal = val.split('_').join(' ')
    div.form-group.d-flex

        if req
            span(style="color: red;") *
            label(for=''+val style="width: 50%;")= displayVal
        else
            label(for=''+val style="width: 50%;")= displayVal

        if defaultValue !== ''
            input(id=val type=''+type name=val class="form-control" style="width: 50%;" required=req value=defaultValue)

        if type.toLowerCase() === 'date'
            input(id=val type=''+type name=val class="form-control" style="width: 50%;" required=req value=`${new Date().toISOString().split('T')[0]}`)
        else
            input(id=val type=''+type name=val class="form-control" style="width: 50%;" required=req)

html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Tracking
    link(rel="stylesheet", href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css")
    link(rel="stylesheet", href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css")
    link(rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css")
  
    script.
        function addStatusValues(defaultText) {
            const statuses = ['Applied', 'Interview', 'Offer', 'Accepted', 'Rejected', 'Declined']

            const StatusSelect = document.getElementById("StatusSelect")
            const CurrentStatusOption = document.getElementById("CurrentStatus")
            CurrentStatusOption.value = statuses.indexOf(defaultText)
            CurrentStatusOption.text = defaultText 


            statuses.forEach((s, i) => {
                if (s !== defaultText) {
                    const option = document.createElement("option")
                    option.value = i
                    option.text = s
                    StatusSelect.append(option)
                }
            })
        }

        function editClick(job) {
            addStatusValues(job['Status'])
            document.getElementById('DateAppliedEdit').value = new Date(''+job['DateApplied']).toISOString().split('T')[0]
            document.getElementById('JobIdEdit').value = job['JobID']
            for (let field in job) {
                if (job.hasOwnProperty(field) && document.getElementById(''+field) != null) {
                    document.getElementById(''+field+'Edit').value = job[field]
                }
            }
        }

        async function deleteJob(job) {
            try {
                const jobID = job.JobID 
                await fetch(`http://localhost:3000/tracking/delete/${jobID}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    }
                })
                location.reload()
            } catch(e) {
                console.log(e)
            }
        }

  body.d-flex(style="background-color: #121212; color: white")
    include layouts/sidebar
    include utils
    div.d-flex.flex-column.align-items-center(style="width: 100%; height: 100vh;") 

        div.d-block.align-items-center.p-2.px-4.mt-4(style="width: 95%; background-color: #212121; border-radius: 5px; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); border: none;") 
            
            div.mt-4.py-4.text-start.border-bottom
                h2 üéØ Your Applications
            hr

            div.text-start
                button.btn.font-weight-bold(type="button", data-toggle="modal", data-target="#NewAppModalForm", style="background-color: #FE6B68; color: white; width: 250px") New App +

            br
            table#applications.table.table-striped.my-4.p-2
                thead
                    tr
                        th(style="color: white") Role 
                        th(style="color: white") Company 
                        th(style="color: white") Status 
                        th(style="color: white") Date Applied
                tbody

                    if jobs
                        each job, i in jobs 
                            tr 
                                td(style="color: white")= job.Role 
                                td(style="color: white")= job.Company 
                                td(style="color: white")= job.Status 
                                td 
                                    div.d-flex.justify-content-between
                                        if job.DateApplied 
                                            p(style="color: white")= `${new Date(job.DateApplied).toISOString().split('T')[0]}`
                                            div.d-flex
                                                button.btn(type="button", data-toggle="modal", data-target="#JobEditModal" onclick=`editClick(${JSON.stringify(job)})` ) ‚úèÔ∏è
                                                button.btn(type="button", onclick=`deleteJob(${JSON.stringify(job)})` ) ‚ùå
            br

        //- New Application modal 
        .modal.fade(id="NewAppModalForm", tabindex="-1", role="dialog", aria-labelledby="NewAppModlLbl", aria-hidden="true", data-backdrop="static")
          .modal-dialog.modal-dialog-centered(role="document")
            .modal-content(style="background-color: #212121; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);")
              .modal-header
                h5.modal-title#NewAppModlLbl ‚ú®New Job Application‚ú®
                button.close(type="button", data-dismiss="modal", aria-label="Close" style="color: white")
                  span(aria-hidden="true") &times;
              .modal-body
                p Please enter the required information below about your latest job application.

                form(action="http://localhost:3000/tracking/manual" method="post")
                    hr
                    br
                    +formInput('Company', 'text', true, '')
                    +formInput('Role', 'text', true, '')
                    +formInput('Date_Applied', 'date', false, '')

                    hr
                    +primarySubmitBtn('Add')
        
        //- Job Edit modal 
        .modal.fade(id="JobEditModal", tabindex="-1", role="dialog", aria-labelledby="JobEditModalLbl", aria-hidden="true", data-backdrop="static")
          .modal-dialog.modal-dialog-centered(role="document")
            .modal-content(style="background-color: #212121; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);")
              .modal-header
                h5.modal-title#JobEditModalLbl Job Edit
                button.close(type="button", data-dismiss="modal", aria-label="Close" style="color: white")
                  span(aria-hidden="true") &times;
              .modal-body
                form(action="http://localhost:3000/tracking/edit" method="post")
                    hr
                    br
                    
                    div.d-none
                        label(for="JobID" style="width: 50%") JobID
                        input#JobIdEdit(name="JobID" type="text" class="form-control" style="width: 50%;")
                    div.form-group.d-flex
                        span(style="color: red;") *
                        label(for="Company" style="width: 50%") Company
                        input#CompanyEdit(name="Company" type="text" class="form-control" style="width: 50%;" required)
                    div.form-group.d-flex
                        span(style="color: red;") *
                        label(for="Role" style="width: 50%") Role
                        input#RoleEdit(name="Role" type="text" class="form-control" style="width: 50%;" required)
                    div.form-group.d-flex
                        label(for="DateApplied" style="width: 50%") Date Applied
                        input#DateAppliedEdit(name="DateApplied" type="date" class="form-control" style="width: 50%;")
                    div.form-group.d-flex
                        label(for="StatusID" style="width: 50%") Status
                        select#StatusSelect.form-select.text-center.border(name="StatusID" aria-label="Application Status values" style="width: 50%")
                            option#CurrentStatus(selected) 

                    hr
                    div.d-flex.flex-row.justify-content-end
                        button.btn.btn-light.font-weight-bold(data-dismiss="modal" style="width: 75px") Cancel
                        button.btn.font-weight-bold.ml-2(type="submit" style="width: 75px; background-color: #FE6B68; color: white") Save


        div(style="height: 100%")
        
        
  //- jQuery
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")
  //- Bootstrap JavaScript bundle
  script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js")
  script(src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js")
  script(src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js")
  script.
    $(document).ready(function() {
        $('#applications').DataTable();
    });